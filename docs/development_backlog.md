# 論文分析系統開發 Backlog

## 總體開發時程規劃 (24小時)

### 階段1: 基礎架構建立 (8小時)
- 資料庫設計與建立
- FastAPI後端核心架構
- 基本的CRUD API

### 階段2: 核心功能實作 (10小時)  
- Grobid整合與檔案處理
- N8N API整合
- 前端核心功能

### 階段3: 整合測試與優化 (6小時)
- 系統整合測試
- 錯誤處理優化
- 效能調整

---

## Backlog 詳細規劃

### 🏗️ **Phase 1: 基礎架構 (優先序 1-8)**

#### **Backlog #1: 資料庫環境建置**
**優先序**: 1  
**估時**: 2小時  
**負責範圍**: 後端基礎設施

**工作項目**:
- 設置PostgreSQL Docker容器
- 建立資料庫schema (papers, paper_sections, sentences, paper_selections, processing_queue, system_settings)
- 建立資料庫索引
- 設置連線池和基本設定

**驗證標準**:
- [ ] PostgreSQL容器正常運行
- [ ] 所有表格成功建立
- [ ] 索引建立完成
- [ ] 可以正常連線和執行基本查詢

**實作檔案**:
- `backend/database/schema.sql`
- `backend/database/connection.py`
- `docker-compose.yml`

---

#### **Backlog #2: FastAPI核心架構**
**優先序**: 2  
**估時**: 2小時  
**負責範圍**: 後端API框架

**工作項目**:
- 建立FastAPI主應用程式
- 設置CORS中間件
- 建立資料庫連線依賴注入
- 設置基本錯誤處理
- 設置日誌系統

**驗證標準**:
- [ ] FastAPI應用程式啟動成功
- [ ] `/docs` API文檔可以訪問
- [ ] 資料庫連線正常
- [ ] CORS設定正確
- [ ] 錯誤日誌正常記錄

**實作檔案**:
- `backend/main.py`
- `backend/core/config.py`
- `backend/core/database.py`
- `backend/core/logging.py`

---

#### **Backlog #3: 基礎CRUD API**
**優先序**: 3  
**估時**: 2小時  
**負責範圍**: 資料存取層

**工作項目**:
- 實作論文管理API (`GET /papers`, `POST /papers/{id}/select`)
- 實作查詢處理API框架
- 實作處理狀態查詢API
- 建立資料庫服務層

**驗證標準**:
- [ ] 可以查詢論文清單
- [ ] 可以切換論文選取狀態
- [ ] 可以查詢處理狀態
- [ ] API回應格式正確
- [ ] 錯誤處理適當

**實作檔案**:
- `backend/api/papers.py`
- `backend/services/db_service.py`
- `backend/models/paper.py`

---

#### **Backlog #4: 檔案管理服務**
**優先序**: 4  
**估時**: 1小時  
**負責範圍**: 檔案上傳與管理

**工作項目**:
- 實作檔案上傳API
- 實作暫存檔案管理
- 實作檔案雜湊計算
- 實作檔案清理機制

**驗證標準**:
- [ ] 可以上傳PDF檔案
- [ ] 檔案雜湊計算正確
- [ ] 重複檔案檢測有效
- [ ] 暫存檔案正常儲存
- [ ] 檔案清理機制正常

**實作檔案**:
- `backend/services/file_service.py`
- `backend/api/upload.py`

---

#### **Backlog #5: Grobid Docker整合**
**優先序**: 5  
**估時**: 1小時  
**負責範圍**: Grobid服務整合

**工作項目**:
- 設置Grobid Docker容器
- 建立Grobid服務包裝類
- 實作TEI XML解析
- 實作章節提取邏輯

**驗證標準**:
- [ ] Grobid容器正常運行
- [ ] 可以呼叫Grobid API
- [ ] TEI XML解析正確
- [ ] 章節提取功能正常
- [ ] 錯誤處理適當

**實作檔案**:
- `backend/services/grobid_service.py`
- `docker-compose.yml` (更新)

---

### 🔧 **Phase 2: 核心功能實作 (優先序 6-15)**

#### **Backlog #6: N8N API整合服務**
**優先序**: 6  
**估時**: 2小時  
**負責範圍**: N8N API整合

**工作項目**:
- 實作現有N8N API呼叫 (OD/CD檢測、關鍵詞提取)
- 建立重試機制與錯誤處理
- 實作批次呼叫管理
- 建立API回應快取

**驗證標準**:
- [ ] 可以正確呼叫OD/CD檢測API
- [ ] 可以正確呼叫關鍵詞提取API
- [ ] 重試機制正常運作
- [ ] 錯誤處理適當
- [ ] 快取機制有效

**實作檔案**:
- `backend/services/n8n_service.py`
- `backend/core/http_client.py`

---

#### **Backlog #7: 批次處理核心邏輯**
**優先序**: 7  
**估時**: 3小時  
**負責範圍**: 檔案處理流水線

**工作項目**:
- 實作完整的檔案處理流水線
- 實作批次句子分析
- 實作進度追蹤
- 實作佇列管理

**驗證標準**:
- [ ] 檔案上傳後自動開始處理
- [ ] Grobid處理正常執行
- [ ] 句子分析批次執行
- [ ] 進度更新正確
- [ ] 處理完成後狀態正確更新

**實作檔案**:
- `backend/services/processing_service.py`
- `backend/services/queue_service.py`

---

#### **Backlog #8: 新N8N API建立**
**優先序**: 8  
**估時**: 2小時  
**負責範圍**: N8N新API開發

**工作項目**:
- 建立查詢意圖分析API
- 建立章節建議API  
- 建立增強型組織回應API
- 建立多檔案內容分析API

**驗證標準**:
- [ ] 查詢意圖分析API正常運作
- [ ] 章節建議API回應正確
- [ ] 增強型組織API支援多檔案
- [ ] 多檔案內容分析API功能完整

**實作檔案**:
- N8N工作流程設置 (4個新API)

---

#### **Backlog #9: 查詢處理服務**
**優先序**: 9  
**估時**: 2小時  
**負責範圍**: 查詢邏輯實作

**工作項目**:
- 實作定義查詢處理器
- 實作內容查詢處理器
- 實作查詢意圖分析
- 實作多檔案整合邏輯

**驗證標準**:
- [ ] 定義查詢正確處理
- [ ] 內容查詢正確處理
- [ ] 查詢意圖分析準確
- [ ] 多檔案回應包含正確引用

**實作檔案**:
- `backend/services/query_service.py`
- `backend/services/definition_processor.py`
- `backend/services/content_processor.py`

---

#### **Backlog #10: 前端React架構重構**
**優先序**: 10  
**估時**: 1小時  
**負責範圍**: 前端架構調整

**工作項目**:
- 移除直接資料庫存取
- 建立統一API服務層
- 更新Zustand狀態管理
- 實作多Client同步

**驗證標準**:
- [ ] 所有資料庫操作透過API
- [ ] 狀態管理簡化為單一使用者模式
- [ ] API服務層正常運作
- [ ] 多Client狀態同步正常

**實作檔案**:
- `src/services/api_service.ts`
- `src/services/paper_service.ts`
- `src/stores/app_store.ts`

---

### 🔗 **Phase 3: 整合與優化 (優先序 11-18)**

#### **Backlog #11: 前端檔案上傳UI**
**優先序**: 11  
**估時**: 1小時  
**負責範圍**: 檔案上傳介面

**工作項目**:
- 更新檔案上傳組件
- 實作進度監控UI
- 實作錯誤顯示與重試按鈕
- 實作檔案去重提示

**驗證標準**:
- [ ] 可以拖拽上傳PDF檔案
- [ ] 進度條正常顯示處理進度
- [ ] 錯誤訊息清楚顯示
- [ ] 重複檔案有適當提示
- [ ] 重試功能正常運作

**實作檔案**:
- `src/components/file/FileUploadZone.tsx`
- `src/components/common/ProgressBar.tsx`

---

#### **Backlog #12: 論文選擇管理UI**
**優先序**: 12  
**估時**: 1小時  
**負責範圍**: 論文管理介面

**工作項目**:
- 實作論文清單顯示
- 實作選取狀態切換
- 實作全選/取消全選功能
- 實作處理狀態顯示

**驗證標準**:
- [ ] 論文清單正確顯示
- [ ] 選取狀態即時更新
- [ ] 全選功能正常
- [ ] 處理狀態清楚顯示
- [ ] 多Client狀態同步

**實作檔案**:
- `src/components/file/FileList.tsx`
- `src/components/file/PaperSelectionPanel.tsx`

---

#### **Backlog #13: 查詢處理UI更新**
**優先序**: 13  
**估時**: 1.5小時  
**負責範圍**: 聊天介面升級

**工作項目**:
- 更新MessageBubble支援新引用格式
- 實作來源摘要顯示
- 更新查詢輸入處理
- 實作載入狀態顯示

**驗證標準**:
- [ ] 引用按鈕正確顯示檔案來源
- [ ] 來源摘要資訊完整
- [ ] 查詢處理載入狀態清楚
- [ ] 錯誤處理使用者友好

**實作檔案**:
- `src/components/chat/MessageBubble.tsx`
- `src/components/chat/ChatInput.tsx`
- `src/components/chat/SourceSummary.tsx`

---

#### **Backlog #14: 錯誤處理與重試機制**
**優先序**: 14  
**估時**: 1小時  
**負責範圍**: 錯誤處理完善

**工作項目**:
- 實作全域錯誤處理
- 實作重試機制UI
- 實作錯誤日誌收集
- 實作使用者友好錯誤訊息

**驗證標準**:
- [ ] 各種錯誤情況都有適當處理
- [ ] 重試按鈕功能正常
- [ ] 錯誤訊息清楚易懂
- [ ] 系統穩定性良好

**實作檔案**:
- `src/services/error_handler.ts`
- `src/components/common/ErrorBoundary.tsx`
- `backend/core/exceptions.py`

---

#### **Backlog #15: 系統整合測試**
**優先序**: 15  
**估時**: 2小時  
**負責範圍**: 端到端測試

**工作項目**:
- 測試完整檔案處理流程
- 測試查詢處理流程
- 測試錯誤情況處理
- 測試多Client同步

**驗證標準**:
- [ ] 端到端檔案處理流程正常
- [ ] 所有查詢類型正確處理
- [ ] 錯誤情況恰當處理
- [ ] 多Client操作同步正常
- [ ] 效能符合預期

**測試項目**:
- 上傳PDF → Grobid處理 → 句子分析 → 查詢回答
- 重複檔案上傳測試
- 各種查詢類型測試
- 錯誤重試測試

---

#### **Backlog #16: 效能優化**
**優先序**: 16  
**估時**: 1小時  
**負責範圍**: 系統效能調優

**工作項目**:
- 優化資料庫查詢效能
- 優化API回應時間
- 實作適當的快取策略
- 優化前端載入速度

**驗證標準**:
- [ ] 資料庫查詢時間合理
- [ ] API回應時間<2秒
- [ ] 前端載入流暢
- [ ] 記憶體使用合理

---

#### **Backlog #17: 部署準備**
**優先序**: 17  
**估時**: 0.5小時  
**負責範圍**: 部署配置

**工作項目**:
- 完善Docker配置
- 設置環境變數管理
- 建立部署腳本
- 設置日誌收集

**驗證標準**:
- [ ] Docker容器正常運行
- [ ] 環境變數正確配置
- [ ] 部署腳本可用
- [ ] 日誌正常收集

**實作檔案**:
- `docker-compose.prod.yml`
- `deploy.sh`
- `.env.example`

---

#### **Backlog #18: 文檔與清理**
**優先序**: 18  
**估時**: 0.5小時  
**負責範圍**: 文檔整理

**工作項目**:
- 更新API文檔
- 建立部署說明
- 建立使用說明
- 程式碼清理

**驗證標準**:
- [ ] API文檔完整準確
- [ ] 部署說明清楚
- [ ] 使用說明易懂
- [ ] 程式碼乾淨整潔

---

## 🎯 **開發順序建議**

### **Day 1 上半天 (12小時)**
1. **Backlog #1-3**: 建立基礎架構 (6小時)
2. **Backlog #4-5**: 檔案管理與Grobid整合 (2小時)
3. **Backlog #6**: N8N API整合 (2小時)
4. **Backlog #8**: 建立新N8N API (2小時)

### **Day 1 下半天 (12小時)**  
5. **Backlog #7**: 批次處理核心邏輯 (3小時)
6. **Backlog #9**: 查詢處理服務 (2小時)
7. **Backlog #10**: 前端架構重構 (1小時)
8. **Backlog #11-13**: 前端UI更新 (3.5小時)
9. **Backlog #14-15**: 錯誤處理與測試 (3小時)
10. **Backlog #16-18**: 優化與部署 (2小時)

## ✅ **關鍵驗收標準**

### **MVP最低要求達成**:
- [x] **單篇論文深度解析**: Grobid分區 + OD/CD分析 + 來源追蹤
- [x] **多篇論文橫向整理**: 多檔案比較 + 統合分析
- [x] **書庫/快取/篩選**: 檔案管理 + 選取機制 + 去重快取  
- [x] **寫作輔助價值**: 引用來源 + 章節定位 + 詳細摘要

### **技術要求達成**:
- [x] PostgreSQL資料庫整合
- [x] Grobid TEI處理
- [x] FastAPI批次處理  
- [x] 檔案自動清理
- [x] 單一使用者多Client支援
- [x] 完整錯誤處理與重試

這個backlog確保在24小時內完成一個功能完整、架構合理的論文分析系統，完全滿足您的畢業要求！ 