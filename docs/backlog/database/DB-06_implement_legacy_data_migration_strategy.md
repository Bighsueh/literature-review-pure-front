# Backlog: DB-06 - 實施遺留資料遷移策略

- **Epic:** 會員系統與多工作區功能導入
- **狀態:** To Do
- **優先級:** High
- **估算 (Story Points):** 5

---

### 使用者故事 (User Story)

**身為** 一位系統管理員，
**我想要** 在系統升級至多工作區架構後，所有既有的、無主的歷史資料（如論文、句子等）都能被自動歸檔到一個預設的「遺留工作區」中，
**以便** 確保沒有任何歷史資訊在本次重大的系統升級中遺失。

---

### 驗收標準 (Acceptance Criteria)

1.  **Alembic 遷移腳本已成功執行：**
    -   [ ] 遷移腳本能夠在一個包含舊資料的資料庫上成功運行並完成，沒有任何錯誤。
    -   [ ] 執行順序正確：先新增欄位 (允許 NULL)，再填充資料，最後設定為 NOT NULL。

2.  **預設實體已建立：**
    -   [ ] 腳本執行後，`users` 表中已建立一筆「預設使用者」紀錄。
    -   [ ] `workspaces` 表中已建立一筆「遺留工作區」紀錄，並與「預設使用者」關聯。

3.  **歷史資料已成功遷移：**
    -   [ ] 所有受影響的表（`papers`, `paper_sections`, `sentences`, etc.）中，所有原本沒有 `workspace_id` 的舊紀錄，其 `workspace_id` 欄位都已被正確填充為「遺留工作區」的 ID。

4.  **資料庫約束已強制執行：**
    -   [ ] 遷移完成後，所有新增的 `workspace_id` 欄位都已被修改為 `NOT NULL`。

---

### 技術筆記 (Technical Notes)

-   **高風險任務**: 此任務直接操作生產資料，需要極度謹慎。所有測試必須在 Docker 容器環境中進行。
-   **腳本設計**: 腳本應使用 Alembic 的 `op.execute()` 來執行資料操作（`INSERT` 預設使用者/工作區，`UPDATE` 舊資料）。
-   **交易性**: 整個遷移過程應在一個交易 (transaction) 中完成，確保資料的一致性。如果任何一步失敗，整個過程都應回滾。
-   **Docker 測試**: 使用 `docker-compose` 建立測試資料庫實例，透過 `docker logs` 監控遷移過程。
-   此任務是所有資料庫模型變更的集大成者，依賴於 `DB-01` 到 `DB-05` 的所有模型定義。 