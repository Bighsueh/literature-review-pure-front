# Backlog: BE-07 - 處理遺留資料存取策略

- **Epic:** 後端 API 改造
- **狀態:** To Do
- **優先級:** High
- **估算 (Story Points):** 5

---

### 使用者故事 (User Story)

**身為** 一位首次使用新系統的使用者，
**我想要** 能夠存取系統升級前就存在的歷史資料（論文、分析結果等），
**以便** 我不會因為系統升級而失去先前的研究成果，並能夠基於這些資料繼續進行工作。

---

### 驗收標準 (Acceptance Criteria)

1.  **遺留工作區存取機制已建立：**
    -   [ ] 已建立特殊端點 `GET /api/legacy-workspace`，讓任何已登入使用者都能取得「遺留工作區」的資訊。
    -   [ ] 此端點會返回一個特殊的 `workspace_id`，對應於資料庫中儲存歷史資料的「遺留工作區」。
    -   [ ] 前端可使用此 `workspace_id` 來存取所有遺留的檔案和資料。

2.  **首次登入流程已優化：**
    -   [ ] 當使用者首次登入且沒有任何個人工作區時，系統會自動建議使用者檢視「遺留工作區」。
    -   [ ] 提供 `GET /api/users/me/onboarding-info` 端點，返回使用者的狀態（新使用者 vs 回歸使用者）和建議的下一步行動。

3.  **資料遷移與個人化機制：**
    -   [ ] 已建立 `POST /api/legacy-workspace/migrate-to-personal` 端點。
    -   [ ] 使用者可以選擇特定的遺留檔案，將其複製到自己的個人工作區中。
    -   [ ] 複製過程會維持檔案的完整性，包括其分析結果和句子分割。

4.  **權限與安全考量：**
    -   [ ] 所有使用者對「遺留工作區」都只有**讀取權限**，無法修改或刪除其中的資料。
    -   [ ] 已實作適當的授權檢查，確保遺留資料的存取是安全的。

---

### 技術筆記 (Technical Notes)

-   **前置條件：** 依賴資料庫階段 `DB-06` (遺留資料遷移策略) 已完成。
-   這是一個**使用者體驗**導向的功能，需要與前端團隊密切合作設計 Onboarding 流程。
-   遺留工作區的 `workspace_id` 應透過環境變數 `LEGACY_WORKSPACE_ID` 設定，以利多環境部署。
-   -   僅系統管理員或資料擁有者可執行複製動作；須檢驗權限。
-   -   // FE NOTE: 若前端要啟用遺留資料瀏覽，請先呼叫 `/api/legacy-workspace` 取得 workspace_id。
-   考慮實作快取機制，因為遺留資料的查詢可能會很頻繁。
-   依賴於 `BE-01` (身份驗證) 和 `BE-02` (工作區管理) 的完成。 