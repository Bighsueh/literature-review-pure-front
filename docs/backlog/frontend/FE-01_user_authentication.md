# FE-01: èº«ä»½é©—è­‰ç³»çµ±æ•´åˆ
# User Authentication System Integration

## ğŸ“‹ åŸºæœ¬è³‡è¨Š (Basic Information)

- **Story ID**: FE-01
- **æ¨™é¡Œ**: èº«ä»½é©—è­‰ç³»çµ±æ•´åˆ
- **Story Points**: 8 SP
- **å„ªå…ˆç´š**: Critical
- **è² è²¬äººå“¡**: Frontend Team
- **é ä¼°å·¥æœŸ**: 1.5 Sprint (3é€±)

## ğŸ¯ ä½¿ç”¨è€…æ•…äº‹ (User Story)

**èº«ç‚º** ç ”ç©¶äººå“¡ä½¿ç”¨è€…  
**æˆ‘æƒ³è¦** ä½¿ç”¨Googleå¸³è™Ÿå®‰å…¨åœ°ç™»å…¥ç³»çµ±  
**ä»¥ä¾¿** æˆ‘å¯ä»¥å‰µå»ºå’Œç®¡ç†è‡ªå·±çš„å€‹äººåŒ–å·¥ä½œå€

## ğŸ“ è©³ç´°æè¿° (Description)

æ•´åˆGoogle OAuth 2.0èº«ä»½é©—è­‰ç³»çµ±èˆ‡JWT tokenç®¡ç†ï¼Œæä¾›å®Œæ•´çš„ä½¿ç”¨è€…èªè­‰æµç¨‹ã€‚åŒ…æ‹¬ç™»å…¥ã€ç™»å‡ºã€è‡ªå‹•tokenåˆ·æ–°ã€å—ä¿è­·è·¯ç”±ç­‰åŠŸèƒ½ï¼Œç¢ºä¿ä½¿ç”¨è€…è³‡æ–™å®‰å…¨å’Œè‰¯å¥½çš„èªè­‰é«”é©—ã€‚

### æŠ€è¡“èƒŒæ™¯
- å¾Œç«¯å·²å¯¦ç¾å®Œæ•´çš„Google OAuth + JWTèªè­‰æ¶æ§‹
- éœ€è¦å»ºç«‹å‰ç«¯èªè­‰ç‹€æ…‹ç®¡ç†å’Œè·¯ç”±ä¿è­·
- å¯¦ç¾å®‰å…¨çš„tokenå„²å­˜å’Œè‡ªå‹•åˆ·æ–°æ©Ÿåˆ¶

## âœ… é©—æ”¶æ¨™æº– (Acceptance Criteria)

### AC-1: Google OAuthç™»å…¥æµç¨‹
- [ ] å¯¦ç¾Google OAuthç™»å…¥æŒ‰éˆ•å’Œåˆå§‹åŒ–æµç¨‹
- [ ] è™•ç†OAuthå›èª¿ä¸¦å®Œæˆèº«ä»½é©—è­‰
- [ ] é¡¯ç¤ºé©ç•¶çš„è¼‰å…¥å’ŒéŒ¯èª¤ç‹€æ…‹
- [ ] ç™»å…¥æˆåŠŸå¾Œè‡ªå‹•å°å‘ä½¿ç”¨è€…çš„é è¨­å·¥ä½œå€

### AC-2: JWT Tokenç®¡ç†
- [ ] å¯¦ç¾JWT tokençš„å®‰å…¨å„²å­˜æ©Ÿåˆ¶ï¼ˆHTTP-only cookiesï¼‰
- [ ] å»ºç«‹è‡ªå‹•tokenåˆ·æ–°é‚è¼¯ï¼Œåœ¨tokenéæœŸå‰è‡ªå‹•æ›´æ–°
- [ ] è™•ç†tokenå¤±æ•ˆæƒ…æ³ï¼Œè‡ªå‹•é‡æ–°å°å‘ç™»å…¥é é¢
- [ ] å¯¦ç¾å®‰å…¨çš„ç™»å‡ºåŠŸèƒ½ï¼Œæ¸…é™¤æ‰€æœ‰èªè­‰è³‡è¨Š

### AC-3: èªè­‰ç‹€æ…‹ç®¡ç†
- [ ] å»ºç«‹å…¨åŸŸèªè­‰ç‹€æ…‹ç®¡ç†ï¼ˆauthStoreï¼‰
- [ ] å¯¦ç¾èªè­‰ç‹€æ…‹çš„æŒä¹…åŒ–å’Œé‚„åŸ
- [ ] æä¾›ä½¿ç”¨è€…è³‡è¨Šçš„å³æ™‚å­˜å–
- [ ] æ”¯æ´èªè­‰ç‹€æ…‹çš„éŸ¿æ‡‰å¼æ›´æ–°

### AC-4: å—ä¿è­·è·¯ç”±å¯¦ç¾
- [ ] å»ºç«‹è·¯ç”±å®ˆè¡›æ©Ÿåˆ¶ï¼Œæœªèªè­‰ä½¿ç”¨è€…è‡ªå‹•å°å‘ç™»å…¥é 
- [ ] å¯¦ç¾ç™»å…¥å¾Œçš„æ·±å±¤é€£çµé‚„åŸ
- [ ] æ”¯æ´è§’è‰²æ¬Šé™æ§åˆ¶ï¼ˆæœªä¾†æ“´å±•ï¼‰
- [ ] è™•ç†èªè­‰éæœŸæ™‚çš„è·¯ç”±é‡å°å‘

### AC-5: ä½¿ç”¨è€…é«”é©—å„ªåŒ–
- [ ] æä¾›å‹å–„çš„ç™»å…¥ç•Œé¢å’Œå¼•å°
- [ ] å¯¦ç¾èªè­‰ç‹€æ…‹çš„è¦–è¦ºå›é¥‹
- [ ] æ”¯æ´è¨˜ä½æˆ‘åŠŸèƒ½ï¼ˆå»¶é•·tokenæœ‰æ•ˆæœŸï¼‰
- [ ] è™•ç†ç¶²è·¯éŒ¯èª¤å’Œèªè­‰å¤±æ•—çš„æƒ…æ³

## ğŸ”§ æŠ€è¡“å¯¦ä½œè©³ç´° (Technical Implementation)

### 1. èªè­‰ç‹€æ…‹ç®¡ç†

```typescript
// èªè­‰Storeè¨­è¨ˆ
interface AuthState {
  isAuthenticated: boolean
  user: User | null
  loading: boolean
  error: string | null
  
  // Actions
  initializeAuth: () => Promise<void>
  login: (authCode: string) => Promise<void>
  logout: () => Promise<void>
  refreshToken: () => Promise<string | null>
  clearError: () => void
}

interface User {
  id: string
  email: string
  name: string
  picture_url?: string
  created_at: string
  updated_at: string
}
```

### 2. OAuthæµç¨‹å¯¦ç¾

```typescript
// OAuthæœå‹™
interface AuthService {
  initiateGoogleAuth(): Promise<string>
  handleAuthCallback(code: string): Promise<AuthResult>
  refreshToken(): Promise<AuthResult>
  logout(): Promise<void>
  getCurrentUser(): Promise<User>
}

interface AuthResult {
  access_token: string
  refresh_token: string
  user: User
  expires_in: number
}
```

### 3. è·¯ç”±ä¿è­·

```typescript
// å—ä¿è­·è·¯ç”±çµ„ä»¶
const ProtectedRoute: React.FC<{
  children: React.ReactNode
  requiredRole?: string
}> = ({ children, requiredRole }) => {
  const { isAuthenticated, user, loading } = useAuth()
  
  if (loading) return <LoadingSpinner />
  if (!isAuthenticated) return <Navigate to="/login" />
  if (requiredRole && !hasRole(user, requiredRole)) {
    return <AccessDenied />
  }
  
  return <>{children}</>
}
```

### 4. Tokenç®¡ç†æ©Ÿåˆ¶

```typescript
// Tokenç®¡ç†å™¨
class TokenManager {
  private refreshTimer: NodeJS.Timeout | null = null
  
  async getValidToken(): Promise<string | null>
  scheduleTokenRefresh(expiresIn: number): void
  clearTokenRefresh(): void
  isTokenExpired(token: string): boolean
}
```

## ğŸ“‹ å­ä»»å‹™åˆ†è§£ (Sub-tasks)

1. **èªè­‰ç‹€æ…‹ç®¡ç†å»ºç«‹** (2 SP)
   - å»ºç«‹authStoreä½¿ç”¨Zustand
   - å¯¦ç¾èªè­‰ç‹€æ…‹çš„æŒä¹…åŒ–
   - å»ºç«‹èªè­‰ç›¸é—œçš„React hooks

2. **Google OAuthæ•´åˆ** (2.5 SP)
   - å¯¦ç¾OAuthç™»å…¥æµç¨‹
   - è™•ç†OAuthå›èª¿å’ŒéŒ¯èª¤
   - å»ºç«‹ç™»å…¥ç•Œé¢UIçµ„ä»¶

3. **JWT Tokenç®¡ç†** (2 SP)
   - å¯¦ç¾tokençš„å®‰å…¨å„²å­˜
   - å»ºç«‹è‡ªå‹•åˆ·æ–°æ©Ÿåˆ¶
   - è™•ç†tokenéæœŸå’ŒéŒ¯èª¤

4. **è·¯ç”±ä¿è­·å¯¦ç¾** (1 SP)
   - å»ºç«‹ProtectedRouteçµ„ä»¶
   - å¯¦ç¾è·¯ç”±å®ˆè¡›é‚è¼¯
   - è™•ç†æ·±å±¤é€£çµé‚„åŸ

5. **UI/UXå¯¦ç¾èˆ‡æ¸¬è©¦** (0.5 SP)
   - è¨­è¨ˆç™»å…¥/ç™»å‡ºç•Œé¢
   - å¯¦ç¾è¼‰å…¥å’ŒéŒ¯èª¤ç‹€æ…‹
   - æ’°å¯«èªè­‰ç›¸é—œæ¸¬è©¦

## ğŸ”— ä¾è³´é—œä¿‚ (Dependencies)

### å‰ç½®ä¾è³´
- âœ… BE-01: Google OAuthèªè­‰ç³»çµ±å®Œæˆ
- âœ… FE-00: APIé©é…èˆ‡TypeScripté¡å‹æ›´æ–°

### å¾ŒçºŒä¾è³´
- FE-02: å¤šå·¥ä½œå€ç‹€æ…‹ç®¡ç†é‡æ§‹
- FE-03: å·¥ä½œå€ç®¡ç†ç•Œé¢é–‹ç™¼
- FE-04: æª”æ¡ˆç®¡ç†ç³»çµ±é‡æ§‹
- FE-05: å°è©±ç³»çµ±å·¥ä½œå€åŒ–é‡æ§‹

## ğŸ§ª æ¸¬è©¦è¨ˆç•« (Testing Plan)

### å–®å…ƒæ¸¬è©¦
- [ ] AuthStoreæ‰€æœ‰æ–¹æ³•çš„å–®å…ƒæ¸¬è©¦
- [ ] TokenManagerçš„tokenç®¡ç†é‚è¼¯æ¸¬è©¦
- [ ] OAuthæœå‹™çš„éŒ¯èª¤è™•ç†æ¸¬è©¦
- [ ] ProtectedRouteçµ„ä»¶çš„è·¯ç”±é‚è¼¯æ¸¬è©¦

### æ•´åˆæ¸¬è©¦
- [ ] å®Œæ•´OAuthç™»å…¥æµç¨‹æ¸¬è©¦
- [ ] Tokenåˆ·æ–°æ©Ÿåˆ¶çš„ç«¯åˆ°ç«¯æ¸¬è©¦
- [ ] è·¯ç”±ä¿è­·çš„æ•´åˆæ¸¬è©¦
- [ ] ç™»å‡ºæµç¨‹çš„å®Œæ•´æ€§æ¸¬è©¦

### ä½¿ç”¨è€…é«”é©—æ¸¬è©¦
- [ ] ç™»å…¥æµç¨‹çš„å¯ç”¨æ€§æ¸¬è©¦
- [ ] èªè­‰å¤±æ•—æƒ…æ³çš„è™•ç†æ¸¬è©¦
- [ ] å¤šæ¨™ç±¤é èªè­‰ç‹€æ…‹åŒæ­¥æ¸¬è©¦
- [ ] ç¶²è·¯ä¸ç©©å®šæƒ…æ³ä¸‹çš„èªè­‰é«”é©—æ¸¬è©¦

## ğŸ“Š æˆåŠŸæŒ‡æ¨™ (Success Metrics)

### åŠŸèƒ½æŒ‡æ¨™
- [ ] Google OAuthç™»å…¥æˆåŠŸç‡ > 98%
- [ ] Tokenè‡ªå‹•åˆ·æ–°æ©Ÿåˆ¶æ­£å¸¸é‹ä½œ
- [ ] èªè­‰ç‹€æ…‹åœ¨æ‰€æœ‰çµ„ä»¶ä¸­æ­£ç¢ºåŒæ­¥
- [ ] å—ä¿è­·è·¯ç”±100%æœ‰æ•ˆæ””æˆªæœªèªè­‰è«‹æ±‚

### æ•ˆèƒ½æŒ‡æ¨™
- [ ] ç™»å…¥æµç¨‹å®Œæˆæ™‚é–“ < 5ç§’
- [ ] Tokenåˆ·æ–°æ“ä½œç„¡æ„ŸçŸ¥ (< 100ms)
- [ ] èªè­‰ç‹€æ…‹æª¢æŸ¥æ™‚é–“ < 50ms
- [ ] é¦–æ¬¡è¼‰å…¥èªè­‰ç‹€æ…‹ < 1ç§’

### å®‰å…¨æŒ‡æ¨™
- [ ] JWT tokenå®‰å…¨å„²å­˜ï¼Œç„¡XSSé¢¨éšª
- [ ] ç„¡æ•æ„Ÿè³‡è¨Šæš´éœ²åœ¨localStorage
- [ ] CSRFæ”»æ“Šé˜²è­·æ©Ÿåˆ¶æœ‰æ•ˆ
- [ ] è‡ªå‹•ç™»å‡ºæ©Ÿåˆ¶åœ¨tokenéæœŸæ™‚è§¸ç™¼

### ä½¿ç”¨è€…é«”é©—æŒ‡æ¨™
- [ ] ç™»å…¥ç•Œé¢ç›´è§€æ˜“æ‡‚ï¼ˆä½¿ç”¨è€…æ¸¬è©¦è©•åˆ† > 4.5/5ï¼‰
- [ ] èªè­‰éŒ¯èª¤è¨Šæ¯æ¸…æ™°æœ‰å¹«åŠ©
- [ ] ç™»å…¥ç‹€æ…‹è¦–è¦ºå›é¥‹åŠæ™‚ä¸”æ˜ç¢º
- [ ] æ·±å±¤é€£çµé‚„åŸåŠŸèƒ½æ­£å¸¸é‹ä½œ

## âš ï¸ é¢¨éšªèˆ‡ç·©è§£ (Risks & Mitigation)

| é¢¨éšªé …ç›® | å½±éŸ¿ç¨‹åº¦ | æ©Ÿç‡ | ç·©è§£ç­–ç•¥ |
|---------|---------|------|----------|
| Google OAuthæœå‹™ä¸­æ–· | High | Low | æä¾›å‚™ç”¨èªè­‰æ–¹å¼ï¼Œé¡¯ç¤ºé©ç•¶éŒ¯èª¤è¨Šæ¯ |
| Tokenå®‰å…¨æ€§æ¼æ´ | High | Low | éµå¾ªOWASPæœ€ä½³å¯¦è¸ï¼Œå®šæœŸå®‰å…¨å¯©æŸ¥ |
| è·¨æ¨™ç±¤é ç‹€æ…‹ä¸åŒæ­¥ | Medium | Medium | å¯¦ç¾BroadcastChannelç‹€æ…‹åŒæ­¥ |
| ç¶²è·¯ä¸ç©©å®šå½±éŸ¿èªè­‰ | Medium | High | å¯¦ç¾é‡è©¦æ©Ÿåˆ¶å’Œé›¢ç·šæ¨¡å¼æç¤º |
| èªè­‰æµç¨‹è¤‡é›œåŒ– | Low | Medium | æä¾›æ¸…æ™°çš„ä½¿ç”¨è€…å¼•å°å’Œå¹«åŠ©æ–‡æª” |

## ğŸ¨ UI/UX è¨­è¨ˆè¦æ±‚ (UI/UX Requirements)

### ç™»å…¥é é¢è¨­è¨ˆ
- [ ] ç°¡æ½”ç¾ä»£çš„ç™»å…¥ç•Œé¢
- [ ] æ¸…æ™°çš„Googleç™»å…¥æŒ‰éˆ•
- [ ] é©ç•¶çš„è¼‰å…¥ç‹€æ…‹æŒ‡ç¤ºå™¨
- [ ] å‹å–„çš„éŒ¯èª¤è¨Šæ¯é¡¯ç¤º

### èªè­‰ç‹€æ…‹é¡¯ç¤º
- [ ] ä½¿ç”¨è€…é ­åƒå’ŒåŸºæœ¬è³‡è¨Šé¡¯ç¤º
- [ ] æ¸…æ™°çš„ç™»å‡ºé¸é …
- [ ] èªè­‰ç‹€æ…‹çš„å³æ™‚è¦–è¦ºå›é¥‹
- [ ] å·¥ä½œå€åˆ‡æ›æ™‚çš„èªè­‰ç¢ºèª

### éŸ¿æ‡‰å¼è¨­è¨ˆ
- [ ] æ”¯æ´æ¡Œé¢ã€å¹³æ¿ã€æ‰‹æ©Ÿä¸‰ç¨®è£ç½®
- [ ] èªè­‰ç•Œé¢åœ¨å°è¢å¹•ä¸Šçš„æœ€ä½³åŒ–
- [ ] è§¸æ§å‹å–„çš„æŒ‰éˆ•å’Œäº’å‹•å…ƒç´ 

## ğŸ“š åƒè€ƒæ–‡æª” (References)

- [Google OAuth 2.0æ–‡æª”](https://developers.google.com/identity/protocols/oauth2)
- [JWTæœ€ä½³å¯¦è¸](https://tools.ietf.org/html/rfc7519)
- [OWASPèªè­‰å®‰å…¨æŒ‡å—](https://owasp.org/www-project-top-ten/)
- [React Routerèªè­‰ç¯„ä¾‹](https://reactrouter.com/docs/en/v6/examples/auth)

## ğŸ”„ Definition of Done

- [ ] æ‰€æœ‰é©—æ”¶æ¨™æº–å®Œæˆä¸¦é€šéæ¸¬è©¦
- [ ] Google OAuthç™»å…¥æµç¨‹å®Œæ•´ä¸”å®‰å…¨
- [ ] JWT tokenç®¡ç†æ©Ÿåˆ¶ç©©å®šå¯é 
- [ ] å—ä¿è­·è·¯ç”±æ­£ç¢ºæ””æˆªæœªèªè­‰ä½¿ç”¨è€…
- [ ] èªè­‰ç‹€æ…‹åœ¨æ‰€æœ‰çµ„ä»¶é–“æ­£ç¢ºåŒæ­¥
- [ ] å–®å…ƒæ¸¬è©¦è¦†è“‹ç‡é”åˆ°90%ä»¥ä¸Š
- [ ] æ•´åˆæ¸¬è©¦æ¶µè“‹æ‰€æœ‰èªè­‰æµç¨‹
- [ ] å®‰å…¨æ€§å¯©æŸ¥é€šéï¼Œç„¡é«˜é¢¨éšªæ¼æ´
- [ ] UI/UXè¨­è¨ˆç¬¦åˆè¦ç¯„ä¸”ä½¿ç”¨è€…é«”é©—è‰¯å¥½
- [ ] è·¨ç€è¦½å™¨ç›¸å®¹æ€§æ¸¬è©¦é€šé
- [ ] æ•ˆèƒ½æŒ‡æ¨™é”åˆ°è¦æ±‚
- [ ] ç¨‹å¼ç¢¼å¯©æŸ¥é€šéï¼Œç¬¦åˆåœ˜éšŠè¦ç¯„
- [ ] æŠ€è¡“æ–‡æª”æ›´æ–°å®Œæˆ

---

**æ³¨æ„**: èº«ä»½é©—è­‰æ˜¯ç³»çµ±å®‰å…¨çš„åŸºçŸ³ï¼Œå¿…é ˆç¢ºä¿æ‰€æœ‰å®‰å…¨æœ€ä½³å¯¦è¸éƒ½å¾—åˆ°æ­£ç¢ºå¯¦æ–½ï¼Œç‚ºå¾ŒçºŒå·¥ä½œå€åŠŸèƒ½æä¾›å®‰å…¨å¯é çš„ä½¿ç”¨è€…èªè­‰åŸºç¤ã€‚ 