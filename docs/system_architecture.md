# 系統架構文檔

## 系統概述

本系統是一個基於網頁的學術論文定義查詢助手，旨在幫助用戶快速從上傳的英文學術論文中找到並理解重要概念和定義。系統通過自然語言處理技術，能夠自動分析文獻內容，提取關鍵句子，並針對用戶的查詢提供精確的定義和上下文。

## 技術架構

### 前端技術

- **框架**: React 18 + TypeScript
- **構建工具**: Vite 5.0
- **樣式系統**: TailwindCSS 3.3.5
- **狀態管理**: Zustand 4.4.6
- **路由系統**: React Router 6.20.0
- **數據獲取**: React Query (TanStack Query) 4.36.1
- **UI組件**:
  - Headless UI (^1.7.17)
  - Heroicons (^2.0.18)
  - Framer Motion (^12.12.2)

### 後端集成

- **HTTP 客戶端**: Axios 1.6.2
- **API 服務**:
  - 句子分割服務 (splitSentencesAPI)
  - N8N 自動化工作流 API (n8nAPI)

### 數據存儲

- **瀏覽器存儲**: IndexedDB (使用 idb 7.1.1)
- **本地狀態持久化**: LocalStorage 服務

### PDF 處理

- **PDF 解析**: PDF.js (pdfjs-dist 3.11.174)
- **PDF 查看**: React PDF 9.2.1

## 系統組件

### 1. 主要佈局組件

- **MainLayout**: 應用程序的主佈局，包括左側、中間和右側面板
- **LeftPanel**: 左側面板，用於文件瀏覽和上傳
- **CenterPanel**: 中央面板，包含聊天界面
- **RightPanel**: 右側面板，顯示參考信息和定義上下文

### 2. 聊天系統組件

- **ChatMessageList**: 顯示消息對話歷史
- **ChatInput**: 用戶輸入查詢的界面
- **MessageBubble**: 單條消息的顯示組件，支持不同類型的消息展示

### 3. 文件處理組件

- 文件上傳和管理相關組件
- PDF處理進度顯示
- 文件解析狀態管理

### 4. 引導和幫助組件

- 引導流程組件
- 使用說明和幫助提示

## 數據流程

1. **文件上傳處理流程**:
   - 用戶上傳PDF文件
   - 前端將文件發送到句子分割服務
   - 服務器處理PDF文件並提取句子
   - 前端接收處理結果並存儲在本地數據庫
   - 系統展示處理進度和完成狀態

2. **查詢處理流程**:
   - 用戶在聊天界面輸入查詢
   - 系統分析查詢內容
   - 從本地處理過的句子數據中檢索相關定義
   - 整合找到的信息并顯示結果，包括原文引用和上下文
   - 允許用戶點擊參考內容查看更多上下文

## 狀態管理

系統使用Zustand進行狀態管理，主要有以下幾個Store：

1. **ChatStore**:
   - 管理對話歷史
   - 存儲當前對話ID
   - 處理消息的創建和更新

2. **AppStore**:
   - 管理應用程序全局狀態
   - 處理選定的參考內容
   - 控制UI狀態和交互

3. **其他Store**:
   - 文件存儲相關狀態
   - 進度跟踪
   - 用戶偏好設置

## API服務

### 1. 句子分割服務 (SplitSentencesAPI)

- 負責處理上傳的PDF文件
- 提取文本內容並分割為句子
- 返回帶有頁碼信息的句子數據

### 2. N8N工作流API (n8nAPI)

- 可能用於更複雜的自動化工作流
- 處理數據轉換或集成外部服務

## 系統解決的問題

1. **學術文獻快速理解問題**:
   - 系統允許用戶快速查找和理解學術論文中的關鍵定義
   - 節省閱讀大量文獻尋找特定概念的時間

2. **上下文理解問題**:
   - 提供定義的同時顯示相關上下文
   - 幫助用戶更全面地理解概念

3. **跨文檔搜索問題**:
   - 支持跨多篇論文搜索和比較定義
   - 建立概念間的關聯和理解

4. **文獻整理和管理問題**:
   - 幫助用戶整理和管理已處理的文獻
   - 保存重要概念和定義以便後續查閱

## 部署和運行環境

- 使用Docker容器化部署
- 提供開發環境和生產環境配置
- 使用Vite進行快速開發和優化的生產構建

## 系統限制和未來改進

1. **當前限制**:
   - 僅支持英文PDF文件
   - 定義識別可能受到文檔格式和質量影響
   - 處理大型文件需要等待時間

2. **未來改進方向**:
   - 多語言支持
   - 更高級的語義理解和概念關聯
   - 改進PDF處理效率和準確性
   - 增強用戶界面和體驗
   - 支持更多文件格式

## 技術實現細節

### 文件處理機制

系統通過PDF.js庫讀取上傳的PDF文件，提取文本內容，然後發送到後端服務進行句子分割和處理。處理後的數據存儲在瀏覽器的IndexedDB中，以支持快速的本地查詢和檢索。

### 查詢處理邏輯

用戶查詢通過自然語言處理進行分析，系統會識別關鍵詞和查詢意圖，然後從已處理的句子中檢索相關內容。系統使用語義相似度和上下文分析來確定最相關的定義和解釋。

### 用戶界面設計

系統採用現代化的三欄式佈局：
- 左側面板用於文件管理
- 中央面板是聊天界面，支持用戶查詢和系統回應
- 右側面板顯示參考內容和詳細上下文

用戶界面設計注重簡潔性和可用性，採用TailwindCSS實現響應式設計，確保在不同設備上的良好體驗。

## 總結

本系統是一個專為學術研究設計的定義查詢助手，通過現代Web技術和自然語言處理，為用戶提供高效的學術概念查詢體驗。系統架構採用前端為主、API服務為輔的設計，實現了高度的用戶交互性和本地數據處理能力，同時保持了良好的可擴展性和性能表現。
